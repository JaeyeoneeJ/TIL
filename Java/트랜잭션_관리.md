- 비즈니스 로직 처리에서 데이터베이스를 사용하는 경우네는 반드시 트랜잭션 관리를 고려해야 함
- 여기서는 @Transactional 어노테이션에 대해 사용법 등을 설명하겠음

## 트랜잭션이란
- 트랜젝션(Transaction)이란 복수의 처리를 하나의 그룹으로 모은 것임
- 트랜잭션은 결과로 ==성공== 아니면 ==실패==만 가질 수 있음
- 처리 중 실패했을 경우에는 트랜잭션은 실행 전의 상태로 돌아감. 이것을 `롤백(Rollback)`이라고 함
- 처리가 모두 성공하면 처리가 확정됨. 이것을 `커밋(Commit)`이라고 함
- 부분적인 성공이나 부분적인 실패라는 모호한 것은 없음

<img src="https://user-images.githubusercontent.com/77138259/229662016-0a9406fc-230a-4495-9f45-7caef7151709.png" alt="트랜잭션" />
<p style="margin:0" align="right"><a href="https://velog.io/@jifrozen/Dining-together-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98Transaction%EA%B3%BC-Transactional-%EC%A0%95%EB%A6%AC">출처: [Dining-together] 트랜잭션(Transaction)과 @Transactional 정리</a></p>

## 트랜잭션 경계란
- 트랜잭션에서는 시작되고 끝나는 위치를 반드시 지정해야 하고, 시작되고 끝날 때까지의 범위를 '트랜잭션 경계'라고 함
- 트랜잭션 경계는 `Service`에서 설정함
	- MVC 모델에서 서비스 처리는 모델임
	- `Service`는 모델의 일부로 비즈니스 로직 처리의 입구(개시)로 생각할 수 있음
	- 이런 이유로 트랜잭션 경계는 `Service`에 지정함

## 트랜잭션 관리 방법
- 트랜잭션 관리는 스프링 프레임워크에서 제공하는 `@Transactional` 어노테이션을 사용함
- 클래스나 메서드에 `@Transactional` 어노테이션을 부여하면 트랜잭션이 관리되어 트랜잭션의 시작, 커밋, 롤백이 자동으로 실행됨
- 롤백의 발생 조건은 비검사(Unchecked) 예외(RuntimeException 혹은 그 서브클래스)가 발생했을 때임
- 검사(Checked) 예외(Exception 혹은 그 서브클래스에서 RuntimeException 외)가 발생했을 경우에는 롤백이 안 되고 커밋이 됨

1. 클래스에 `@Transactional` 어노테이션 부여하기
- 클래스에 `@Transactional` 어노테이션을 부여하면 그 클래스의 모든 메서드에 트랜잭션 제어를 설정할 수 있음(`@Transactional` 어노테이션은 `public` 메서드만 적용됨)

2. 메서드에 `@Transactional` 어노테이션 부여하기
- 메서드에 `@Transactional` 어노테이션을 부여하면 메서드가 호출되는 타이밍(정확하게는 메서드 시작 전)에 트랜잭션이 시작도이ㅓ 대상 메서드가 정상 종료한 경우에는 '==커밋==', 예외로 종료한 경우에는 '==롤백=='됨

> 여기서는 클래스에 `@Transactional `어노테이션을 부여하는 것을 추천함
> 
> 트랜잭션 경계의 설정이 필요한 경우는 변경 처리(등록, 변경, 삭제)를 포함한 서비스 처리뿐이지만 설정 실수 등으로 인한 버그 등을 방지하는 목적으로 클래스에 `@Transactional` 어노테이션을 부여하는 것을 추천함
> 
> 어떤한 방법을 선택하더라도 어노테이션을 부여하는 것만으로 `자동으로 커밋이나 롤백`을 해주기 때문에 상당히 편리한 기능임

## @Transactional
- 스프링 프레임워크에서는 여러 가지 공통 기능을 AOP로 제공함. 그 중 대표적인 것이 `@Transactional`임
- `@Transactional`을 사용하지 않고 복수의 명령을 트랜잭션 관리하는 경우에는 개발자가 JDBC의 자동 커밋 설정을 `setAutoCommit` 메서드에서 false를 설정해서 무효화하고, 변경 처리를 데이터베이스에 반영하기 위해 다시 `commit` 메서드를 호출해야 하고 예외가 발생한 경우에는 `rollback` 메서드를 불러와야 함
- 위와 같이 번잡했던 '횡단적 관심사'도 `@Transactional` 어노테이션을 부여함으로써 스프링 프레임워크가 담당하기 때문에 '중심적 관심사'인 데이터베이스 액세스 처리에 집중할 수 있음